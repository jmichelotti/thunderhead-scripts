<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
  <style>
    body {
      width: 420px;
      max-height: 550px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 13px;
      margin: 0;
      padding: 12px;
      background: #1a1a2e;
      color: #e0e0e0;
    }
    h2 {
      margin: 0 0 8px 0;
      font-size: 15px;
      color: #7c3aed;
    }
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #333;
    }
    .server-status {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 10px;
    }
    .server-up { background: #064e3b; color: #6ee7b7; }
    .server-down { background: #7f1d1d; color: #fca5a5; }
    button {
      background: #374151;
      color: #e0e0e0;
      border: none;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    button:hover { background: #4b5563; }
    .section-label {
      font-size: 11px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 10px 0 6px 0;
    }
    .scrollable {
      overflow-y: auto;
      max-height: 420px;
    }

    /* Pending confirmation cards */
    .pending-card {
      padding: 10px;
      margin-bottom: 6px;
      background: #1e1e3a;
      border-radius: 6px;
      border-left: 3px solid #f59e0b;
    }
    .pending-card.loading { border-left-color: #6b7280; }
    .pending-card.error { border-left-color: #ef4444; }
    .pending-title {
      font-weight: 600;
      font-size: 14px;
      color: #f3f4f6;
      margin-bottom: 4px;
    }
    .pending-meta {
      display: flex;
      gap: 12px;
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 8px;
    }
    .pending-meta .quality { color: #818cf8; font-weight: 600; }
    .pending-meta .episode { color: #a78bfa; }
    .pending-loading {
      font-size: 12px;
      color: #6b7280;
      font-style: italic;
    }
    .pending-error {
      font-size: 12px;
      color: #fca5a5;
    }
    .pending-actions {
      display: flex;
      gap: 8px;
      margin-top: 6px;
    }
    .btn-download {
      background: #065f46;
      color: #6ee7b7;
      font-weight: 600;
      padding: 5px 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-download:hover { background: #047857; }
    .btn-download:disabled { background: #374151; color: #6b7280; cursor: not-allowed; }
    .btn-dismiss {
      background: #374151;
      color: #9ca3af;
      padding: 5px 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-dismiss:hover { background: #4b5563; }

    /* Download progress cards */
    .dl-card {
      padding: 8px 10px;
      margin-bottom: 6px;
      background: #16213e;
      border-radius: 6px;
      border-left: 3px solid #555;
    }
    .dl-card.downloading { border-left-color: #f59e0b; }
    .dl-card.done { border-left-color: #22c55e; }
    .dl-card.error { border-left-color: #ef4444; }
    .dl-card.queued { border-left-color: #6366f1; }
    .dl-card.moving { border-left-color: #8b5cf6; }
    .dl-card.dry_run { border-left-color: #6b7280; }
    .dl-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .dl-filename {
      font-weight: 600;
      font-size: 13px;
      color: #f3f4f6;
    }
    .dl-status {
      font-size: 11px;
      padding: 1px 6px;
      border-radius: 8px;
      font-weight: 600;
    }
    .dl-status.downloading { background: #78350f; color: #fbbf24; }
    .dl-status.done { background: #064e3b; color: #6ee7b7; }
    .dl-status.error { background: #7f1d1d; color: #fca5a5; }
    .dl-status.queued { background: #312e81; color: #a5b4fc; }
    .dl-status.moving { background: #4c1d95; color: #c4b5fd; }
    .dl-status.dry_run { background: #374151; color: #9ca3af; }
    .dl-meta {
      display: flex;
      gap: 12px;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .dl-meta span { white-space: nowrap; }
    .dl-meta .quality { color: #818cf8; font-weight: 600; }
    .progress-bar-bg {
      width: 100%;
      height: 6px;
      background: #1e293b;
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #7c3aed, #a78bfa);
      border-radius: 3px;
      transition: width 0.3s ease;
    }
    .progress-bar-fill.done {
      background: #22c55e;
    }
    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      color: #6b7280;
      margin-top: 3px;
    }
    .empty {
      color: #6b7280;
      text-align: center;
      padding: 30px 0;
    }

    /* Auto-capture section */
    .auto-capture {
      margin-bottom: 10px;
      padding: 10px;
      background: #1e1e3a;
      border-radius: 6px;
      border-left: 3px solid #6366f1;
    }
    .auto-capture.hidden { display: none; }
    .auto-capture.active { border-left-color: #22c55e; }
    .ac-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .ac-title {
      font-size: 11px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .ac-season {
      font-size: 12px;
      color: #a78bfa;
      font-weight: 600;
    }
    .ac-inputs {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }
    .ac-inputs label {
      font-size: 12px;
      color: #9ca3af;
    }
    .ac-inputs input[type="number"] {
      width: 46px;
      padding: 3px 6px;
      background: #374151;
      color: #e0e0e0;
      border: 1px solid #4b5563;
      border-radius: 4px;
      font-size: 12px;
      text-align: center;
    }

    /* DOM inspector */
    .inspector-bar {
      display: flex;
      gap: 6px;
      align-items: center;
      margin: 8px 0 4px 0;
      padding-top: 8px;
      border-top: 1px solid #2d2d4a;
    }
    .btn-inspect {
      background: #1e3a5f;
      color: #93c5fd;
      font-size: 11px;
      padding: 3px 8px;
    }
    .btn-inspect:hover { background: #1e4976; }
    .btn-copy-inspect {
      background: #1e3a2a;
      color: #6ee7b7;
      font-size: 11px;
      padding: 3px 8px;
      display: none;
    }
    .btn-copy-inspect:hover { background: #1a4a35; }
    #inspectResults {
      display: none;
      margin: 4px 0 8px 0;
      padding: 8px;
      background: #0f172a;
      border: 1px solid #2d2d4a;
      border-radius: 4px;
      font-family: "Consolas", "Courier New", monospace;
      font-size: 10px;
      color: #94a3b8;
      white-space: pre;
      overflow-x: auto;
      max-height: 200px;
      overflow-y: auto;
    }
    .ac-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .btn-auto-capture {
      background: #4338ca;
      color: #c7d2fe;
      font-weight: 600;
      padding: 5px 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-auto-capture:hover { background: #4f46e5; }
    .btn-auto-capture:disabled { background: #374151; color: #6b7280; cursor: not-allowed; }
    .btn-stop {
      background: #7f1d1d;
      color: #fca5a5;
      font-weight: 600;
      padding: 5px 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-stop:hover { background: #991b1b; }
    .ac-status {
      font-size: 12px;
      color: #9ca3af;
      margin-left: 8px;
    }
    .ac-status.running { color: #6ee7b7; }
    .ac-status.done { color: #a78bfa; }
    .ac-status.error { color: #fca5a5; }
    .ac-mode-tabs {
      display: flex;
      background: #0f172a;
      border-radius: 6px;
      padding: 2px;
      gap: 2px;
      margin-bottom: 10px;
    }
    .ac-mode-tab {
      flex: 1;
      text-align: center;
      padding: 5px 0;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      color: #6b7280;
      background: transparent;
      border: none;
      transition: all 0.15s ease;
    }
    .ac-mode-tab:hover { color: #9ca3af; background: #1e293b; }
    .ac-mode-tab.active { background: #4338ca; color: #e0e0ff; }
  </style>
</head>
<body>
  <div class="status-bar">
    <h2>HLS Capture</h2>
    <span id="serverStatus" class="server-status server-down">checking...</span>
    <button id="clearBtn">Clear</button>
  </div>
  <div id="autoCapture" class="auto-capture hidden">
    <div class="ac-header">
      <span class="ac-title">AUTO-CAPTURE</span>
      <span id="acSite" class="ac-season"></span>
    </div>
    <div class="ac-mode-tabs" id="acModeTabs">
      <button class="ac-mode-tab active" data-mode="episodes">Episodes</button>
      <button class="ac-mode-tab" data-mode="seasons">Seasons</button>
    </div>
    <div id="acIdle">
      <div class="ac-inputs">
        <label>S</label>
        <input type="number" id="acSeasonInput" min="1" value="1">
        <span id="acSeasonEndWrap" style="display:none;">
          <label>–</label>
          <input type="number" id="acSeasonEndInput" min="1" value="5">
        </span>
        <span id="acEpWrap">
          <label>EP</label>
          <input type="number" id="acFromEp" min="1" value="1">
          <label>–</label>
          <input type="number" id="acToEp" min="1" value="10">
        </span>
        <label>Srv</label>
        <input type="number" id="acServerInput" min="1" max="9" value="1" title="Server number (1=default)">
      </div>
      <div class="ac-actions">
        <button id="acStartBtn" class="btn-auto-capture">Auto-capture</button>
        <span id="acIdleStatus" class="ac-status"></span>
      </div>
    </div>
    <div id="acRunning" style="display:none;">
      <div class="ac-actions">
        <button id="acStopBtn" class="btn-stop">Stop</button>
        <span id="acRunStatus" class="ac-status running"></span>
      </div>
    </div>
  </div>
  <div class="inspector-bar">
    <button id="inspectBtn" class="btn-inspect">Inspect Page DOM</button>
    <button id="copyInspectBtn" class="btn-copy-inspect">Copy</button>
    <span id="inspectStatus" style="font-size:11px; color:#6b7280;"></span>
  </div>
  <pre id="inspectResults"></pre>

  <div id="pending"></div>
  <div id="downloads" class="scrollable">
    <div class="empty">No downloads yet. Browse to a video page and press play.</div>
  </div>
  <script src="popup.js"></script>
</body>
</html>
